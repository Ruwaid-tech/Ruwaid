{% extends 'base.html' %}
{% block content %}
<h2>Manage Users</h2>
<table>
<tr><th>Email</th><th>Status</th><th>Role</th><th>Role Expires</th><th>Failed PINs</th><th>Actions</th></tr>
{% for user in users %}
<tr>
  <td>{{ user.email }}</td>
  <td>{{ user.status.value }}</td>
  <td>{{ user.role.value }}</td>
  <td>{{ user.role_expires_at or '-' }}</td>
  <td>{{ user.failed_pin_attempts }}{% if user.last_failed_at %} (last: {{ user.last_failed_at }}){% endif %}</td>
  <td>
    <form method="post" action="{{ url_for('admin.approve_user', user_id=user.user_id) }}" style="display:inline">{{ role_form.csrf_token }}<button type="submit">Approve</button></form>
    <form method="post" action="{{ url_for('admin.deactivate_user', user_id=user.user_id) }}" style="display:inline">{{ role_form.csrf_token }}<button type="submit">Deactivate</button></form>
    <form method="post" action="{{ url_for('admin.set_temp_admin', user_id=user.user_id) }}" style="display:inline">
      {{ role_form.csrf_token }}
      {{ role_form.role_expires_at() }}
      <button type="submit">Temp Admin</button>
    </form>
    <form method="post" action="{{ url_for('admin.clear_admin', user_id=user.user_id) }}" style="display:inline">{{ role_form.csrf_token }}<button type="submit">Clear Admin</button></form>
  </td>
</tr>
{% endfor %}
</table>
{% endblock %}
