{% extends 'base.html' %}
{% block content %}
<section class="panel">
    <div class="panel-header">
        <div>
            <h1>Gallery</h1>
            <p>Browse available artworks</p>
        </div>
        <div class="cart-summary">Cart: {{ cart_count }} item(s)</div>
    </div>
    <form class="filters" method="get">
        <input type="text" name="search" placeholder="Search title or description" value="{{ search }}">
        <select name="category">
            <option value="All" {% if category=='All' %}selected{% endif %}>All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if category==cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        <select name="sort">
            <option value="" {% if not sort %}selected{% endif %}>Newest</option>
            <option value="asc" {% if sort=='asc' %}selected{% endif %}>Price ↑</option>
            <option value="desc" {% if sort=='desc' %}selected{% endif %}>Price ↓</option>
        </select>
        <button class="btn" type="submit">Apply</button>
    </form>
    <div class="card-grid">
        {% for art in artworks %}
        <div class="card">
            <img src="{{ art['image_url'] }}" alt="{{ art['title'] }}">
            <div class="card-body">
                <h3>{{ art['title'] }}</h3>
                <p class="desc">{{ art['description'][:120] }}{% if art['description']|length > 120 %}...{% endif %}</p>
                <p class="price">{{ format_currency(art['price']) }}</p>
            </div>
            <div class="card-actions">
                <a class="btn ghost" href="{{ url_for('artwork_detail', artwork_id=art['id']) }}">View Details</a>
                <form method="post" action="{{ url_for('cart_add', artwork_id=art['id']) }}">
                    <input type="hidden" name="quantity" value="1">
                    <button class="btn primary" type="submit">Add</button>
                </form>
            </div>
        </div>
        {% else %}
        <p>No artworks found.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
