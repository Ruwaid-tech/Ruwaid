{% extends 'base.html' %}
{% block content %}
<section class="panel">
    <h1>Cart & Checkout</h1>
    {% if errors.get('cart') %}<p class="error">{{ errors['cart'] }}</p>{% endif %}
    <div class="cart-layout">
        <div class="cart-items">
            {% for item in items %}
            <div class="cart-item">
                <div>
                    <h3>{{ item.artwork['title'] }}</h3>
                    <p>Qty: {{ item.qty }}</p>
                </div>
                <div>
                    <p>{{ format_currency(item.line_total) }}</p>
                    <form method="post" action="{{ url_for('cart_remove', artwork_id=item.artwork['id']) }}">
                        <button class="btn ghost" type="submit">Remove</button>
                    </form>
                </div>
            </div>
            {% else %}
            <p>Your cart is empty.</p>
            {% endfor %}
            <div class="cart-total">
                <strong>Total:</strong> {{ format_currency(total) }}
            </div>
        </div>
        <div class="checkout-form">
            <form method="post" action="{{ url_for('checkout') }}">
                <h2>Buyer Details</h2>
                <label>Name</label>
                <input type="text" name="name" value="{{ form_data.get('name','') }}" required>
                {% if errors.get('name') %}<p class="error">{{ errors['name'] }}</p>{% endif %}
                <label>Phone</label>
                <input type="text" name="phone" value="{{ form_data.get('phone','') }}" required>
                {% if errors.get('phone') %}<p class="error">{{ errors['phone'] }}</p>{% endif %}
                <label>Address</label>
                <textarea name="address" required>{{ form_data.get('address','') }}</textarea>
                {% if errors.get('address') %}<p class="error">{{ errors['address'] }}</p>{% endif %}
                {% if errors.get('stock') %}<p class="error">{{ errors['stock'] }}</p>{% endif %}
                <div class="payment">
                    <h3>Payment</h3>
                    <label><input type="radio" checked> Cash on Delivery</label>
                </div>
                <div class="actions">
                    <button class="btn primary" type="submit">Confirm Order</button>
                    <a class="btn ghost" href="{{ url_for('gallery') }}">Continue Shopping</a>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}
